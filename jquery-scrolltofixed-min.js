(function(e){e.isScrollToFixed=function(t){return!!e(t).data("ScrollToFixed")};e.ScrollToFixed=function(t,n){function y(){o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed");d=-1;c=o.offset().top;h=o.offset().left;if(r.options.offsets){h+=o.offset().left-o.position().left}if(p==-1){p=h}u=o.css("position");s=true;if(r.options.bottom!=-1){o.trigger("preFixed.ScrollToFixed");x();o.trigger("fixed.ScrollToFixed")}}function b(){var e=r.options.limit;if(!e)return 0;if(typeof e==="function"){return e.apply(o)}return e}function w(){return u==="fixed"}function E(){return u==="absolute"}function S(){return!(w()||E())}function x(){if(!w()){v.css({display:o.css("display"),width:o.outerWidth(true),height:o.outerHeight(true),"float":o.css("float")});cssOptions={"z-index":r.options.zIndex,position:"fixed",top:r.options.bottom==-1?k():"",bottom:r.options.bottom==-1?"":r.options.bottom,"margin-left":"0px"};if(!r.options.dontSetWidth){cssOptions["width"]=o.css("width")}o.css(cssOptions);o.addClass(r.options.baseClassName);if(r.options.className){o.addClass(r.options.className)}u="fixed"}}function T(){var e=b();var t=h;if(r.options.removeOffsets){t="";e=e-c}cssOptions={position:"absolute",top:e,left:t,"margin-left":"0px",bottom:""};if(!r.options.dontSetWidth){cssOptions["width"]=o.css("width")}o.css(cssOptions);u="absolute"}function N(){if(!S()){d=-1;v.css("display","none");o.css({"z-index":l,width:"",position:a,left:"",top:f,"margin-left":""});o.removeClass("scroll-to-fixed-fixed");if(r.options.className){o.removeClass(r.options.className)}u=null}}function C(e){if(e!=d){o.css("left",h-e);d=e}}function k(){var e=r.options.marginTop;if(!e)return 0;if(typeof e==="function"){return e.apply(o)}return e}function L(){if(!e.isScrollToFixed(o))return;var t=s;if(!s){y()}else if(S()){c=o.offset().top;h=o.offset().left}var n=i.scrollLeft();var u=i.scrollTop();var f=b();if(r.options.minWidth&&i.width()<r.options.minWidth){if(!S()||!t){O();o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed")}}else if(r.options.maxWidth&&i.width()>r.options.maxWidth){if(!S()||!t){O();o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed")}}else if(r.options.bottom==-1){if(f>0&&u>=f-k()){if(!E()||!t){O();o.trigger("preAbsolute.ScrollToFixed");T();o.trigger("unfixed.ScrollToFixed")}}else if(u>=c-k()){if(!w()||!t){O();o.trigger("preFixed.ScrollToFixed");x();d=-1;o.trigger("fixed.ScrollToFixed")}C(n)}else{if(!S()||!t){O();o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed")}}}else{if(f>0){if(u+i.height()-o.outerHeight(true)>=f-(k()||-A())){if(w()){O();o.trigger("preUnfixed.ScrollToFixed");if(a==="absolute"){T()}else{N()}o.trigger("unfixed.ScrollToFixed")}}else{if(!w()){O();o.trigger("preFixed.ScrollToFixed");x()}C(n);o.trigger("fixed.ScrollToFixed")}}else{C(n)}}}function A(){if(!r.options.bottom)return 0;return r.options.bottom}function O(){var e=o.css("position");if(e=="absolute"){o.trigger("postAbsolute.ScrollToFixed")}else if(e=="fixed"){o.trigger("postFixed.ScrollToFixed")}else{o.trigger("postUnfixed.ScrollToFixed")}}var r=this;r.$el=e(t);r.el=t;r.$el.data("ScrollToFixed",r);var i;var s=false;var o=r.$el;var u;var a;var f;var l;var c=0;var h=0;var p=-1;var d=-1;var v=null;var m;var g;var M=function(e){if(o.is(":visible")){s=false;L()}};var _=function(e){!!window.requestAnimationFrame?requestAnimationFrame(L):L()};var D=function(){var e=document.body;if(document.createElement&&e&&e.appendChild&&e.removeChild){var t=document.createElement("div");if(!t.getBoundingClientRect)return null;t.innerHTML="x";t.style.cssText="position:fixed;top:100px;";e.appendChild(t);var n=e.style.height,r=e.scrollTop;e.style.height="3000px";e.scrollTop=500;var i=t.getBoundingClientRect().top;e.style.height=n;var s=i===100;e.removeChild(t);e.scrollTop=r;return s}return null};var P=function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}e.returnValue=false};r.init=function(){r.options=e.extend({},e.ScrollToFixed.defaultOptions,n);i=r.options.scrollParent;l=o.css("z-index");r.$el.css("z-index",r.options.zIndex);v=e("<div />");u=o.css("position");a=o.css("position");f=o.css("top");if(S())r.$el.after(v);i.bind("resize.ScrollToFixed",M);i.bind("scroll.ScrollToFixed",_);if("ontouchmove"in window){i.bind("touchmove.ScrollToFixed",L)}if(r.options.preFixed){o.bind("preFixed.ScrollToFixed",r.options.preFixed)}if(r.options.postFixed){o.bind("postFixed.ScrollToFixed",r.options.postFixed)}if(r.options.preUnfixed){o.bind("preUnfixed.ScrollToFixed",r.options.preUnfixed)}if(r.options.postUnfixed){o.bind("postUnfixed.ScrollToFixed",r.options.postUnfixed)}if(r.options.preAbsolute){o.bind("preAbsolute.ScrollToFixed",r.options.preAbsolute)}if(r.options.postAbsolute){o.bind("postAbsolute.ScrollToFixed",r.options.postAbsolute)}if(r.options.fixed){o.bind("fixed.ScrollToFixed",r.options.fixed)}if(r.options.unfixed){o.bind("unfixed.ScrollToFixed",r.options.unfixed)}if(r.options.spacerClass){v.addClass(r.options.spacerClass)}o.bind("resize.ScrollToFixed",function(){v.height(o.height())});o.bind("scroll.ScrollToFixed",function(){o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed");L()});o.bind("detach.ScrollToFixed",function(e){P(e);o.trigger("preUnfixed.ScrollToFixed");N();o.trigger("unfixed.ScrollToFixed");i.unbind("resize.ScrollToFixed",M);i.unbind("scroll.ScrollToFixed",_);o.unbind(".ScrollToFixed");v.remove();r.$el.removeData("ScrollToFixed")});M()};r.init()};e.ScrollToFixed.defaultOptions={marginTop:0,limit:0,bottom:-1,zIndex:1e3,baseClassName:"scroll-to-fixed-fixed",scrollParent:e(window)};e.fn.scrollToFixed=function(t){return this.each(function(){new e.ScrollToFixed(this,t)})}})(jQuery)
